<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="white">
    <meta http-equiv="pragma" content="no-cache">
    <title>VP贷-享全款的汽车分期</title>
    <link href="/public/wap/images/logo-ico.png" type="image/x-icon" rel="shortcut icon">
    <link rel="stylesheet" href="/public/wap/css/framework7.ios.css">
    <link rel="stylesheet" href="/public/wap/css/framework7.ios.colors.min.css">
    <link rel="stylesheet" type="text/css" href="/public/plugs/webuploader/webuploader.css">
    <link rel="stylesheet" type="text/css" href="/public/plugs/webuploader/webuploader.gemini.css">
    <link rel="stylesheet" type="text/css" href="/public/wap/css/new-app.css" media="all">
    <script type="text/javascript">
        var BASE_URL = "";

        var orderData = {};
        var picList = [];
        var keyList = [
            {
                form_key:"orderSupplement_pic_1",
                form_label:"身份证正面照"
            },
            {
                form_key:"orderSupplement_pic_2",
                form_label:"身份证反面照"
            },
            {
                form_key:"orderSupplement_pic_3",
                form_label:"人车合照"
            },
            {
                form_key:"orderSupplement_pic_4",
                form_label:"合格证"
            },
            {
                form_key:"orderSupplement_pic_5",
                form_label:"保单证书"
            },
            {
                form_key:"orderSupplement_pic_6",
                form_label:"购车发票"
            },
            {
                form_key:"orderSupplement_pic_7",
                form_label:"首付凭证"
            },
            {
                form_key:"orderSupplement_pic_8",
                form_label:"合同"
            },
            {
                form_key:"orderSupplement_pic_9",
                form_label:"代扣银行卡"
            }];

        var keyList_guarantors = [
            {
                form_key:"orderSupplement_pic_1",
                form_label:"身份证正面照"
            },
            {
                form_key:"orderSupplement_pic_2",
                form_label:"身份证反面照"
            },
            {
                form_key:"orderSupplement_pic_3",
                form_label:"车辆照片1"
            },
            {
                form_key:"orderSupplement_pic_4",
                form_label:"车辆照片2"
            },
            {
                form_key:"orderSupplement_pic_5",
                form_label:"车辆照片3"
            },
            {
                form_key:"orderSupplement_pic_6",
                form_label:"车辆照片4"
            },
            {
                form_key:"orderSupplement_pic_7",
                form_label:"签约照"
            },
            {
                form_key:"orderSupplement_pic_8",
                form_label:"合同"
            }];

            // for(var i=0 ; i<keyList.length;i++){
            //     if(typeof(orderData[keyList[i].form_key]) == "object" ){
            //         picList.push(orderData[keyList[i].form_key]);
            //         keyList[i].has = 1;
            //     }
            // }
    </script>
    <style type="text/css">
        .order-item {
            height: 38px;
            line-height: 38px;
            font-size: 14px;
        }
        .order-amount,
        .order-term {
            padding-left: 0;
            border-bottom: 1px solid #dedede;
        }
    </style>
</head>
<body>
    <div class="views">
        <div class="view view-main">
            <div class="navbar wb">
                <div class="navbar-inner">
                    <div class="left">
                        <a href="javascript:history.go(-1)" class="link icon-only back">
                            <i class="icon icon-back color-orange"></i>
                        </a>
                    </div>
                    <div class="center" id="navbar_title">订单资料提交</div>
                    <div class="right"></div>
                </div>
            </div>
            <div class="pages navbar-through">
                <div class="page">
                    <div class="page-content">
                        <div class="list-block mt10">
                            <ul>
                                <li class="accordion-item">
                                    <a href="#" class="item-content item-link">
                                        <div class="item-inner">
                                          <div class="item-title">订单编号(<span class="order-sn"></span>)</div>
                                        </div>
                                    </a>
                                    <div class="accordion-item-content">
                                        <div class="content-block">
                                            <ul class="clearfix">
                                                <li class="order-item">
                                                    <div class="order-info-type">
                                                        <span>订单业务</span>
                                                        <span class="pull-right order-type"></span>
                                                    </div>
                                                </li>
                                                <li class="order-item">
                                                    <div class="order-info-loaner">
                                                        <span>客户姓名</span>
                                                        <span class="pull-right order-loaner"></span>
                                                    </div>
                                                </li>
                                                <li class="order-item">
                                                    <div class="order-info-mobile">
                                                        <span>手机号</span>
                                                        <span class="pull-right order-mobile"></span>
                                                    </div>
                                                </li>
                                                <li class="order-item">
                                                    <div class="order-info-idcardNum">
                                                        <span>身份证号</span>
                                                        <span class="pull-right order-idcardNum"></span>
                                                    </div>
                                                </li>
                                                <li class="order-item">
                                                    <div class="order-info-date">
                                                        <span>申请时间</span>
                                                        <span class="pull-right order-date"></span>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </li>
                                <li class="accordion-item accordion-item-expanded">
                                    <a href="#" class="item-content item-link">
                                        <div class="item-inner">
                                            <div class="item-title">完善资料</div>
                                        </div>
                                    </a>
                                    <div class="accordion-item-content">
                                        <div class="content-block">
                                            <div id="type-1" style="display: none;">
                                                <div class="item-content order-info-amount order-amount">
                                                    <div class="item-inner">
                                                        <div class="item-title label">借款金额(元)</div>
                                                        <div class="item-input">
                                                            <input type="number" name="loan_limit" placeholder="请输入借款金额">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="item-content order-info-term order-term">
                                                    <div class="item-inner">
                                                        <div class="item-title label">借款期限(月)</div>
                                                        <div class="item-input">
                                                            <!-- <select name="loan_term" class="button">
                                                                <option value="365">12个月</option>
                                                                <option value="730">24个月</option>
                                                                <option value="1095">36个月</option>
                                                            </select> -->
                                                            <input type="text" placeholder="借款期限" readonly id="myPicker">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="type-2" style="display: none;">
                                                <div class="item-content order-info-amount order-amount">
                                                    <div class="item-inner">
                                                        <div class="item-title label">垫资金额(元)</div>
                                                        <div class="item-input">
                                                            <input type="number" name="loan_limit" placeholder="请输入垫资金额">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="item-content order-info-term order-term">
                                                    <div class="item-inner">
                                                        <div class="item-title label">垫资期限(天)</div>
                                                        <div class="item-input">
                                                             <input type="number" name="loan_term" value="" placeholder="垫资期限为1-15天">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group loanerInfo">
                                                <div class="uploaderwrap">
                                                    <div class="uploader_title">
                                                        <h4>请上传借款资料照片</h4>
                                                    </div>
                                                    <div id="uploadpic"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="content-block">
                            <a class="button button-big button-fill color-orange" id="submit">提交</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="dialog" class="dialog">
        <div id="dialogContent">
            <div id="dialogMain"></div>
        </div>
    </div>
    <div id="loading"></div>
    <script type="text/javascript" src="/public/wap/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="/public/wap/js/framework7.min.js"></script>
    <script type="text/javascript" src="/public/wap/js/my-app.js?v=1"></script>
    <script type="text/javascript" src="/public/plugs/webuploader/webuploader.min.js"></script>
    <script type="text/javascript" src="/public/wap/js/webuploader.gemini.js"></script>
    <script type="text/javascript" src="/public/wap/js/order.js"></script>
    <script type="text/javascript">
        var order_id = getUrlParam('id');
        var sid = localStorage.getItem('sid');
        var order_type = '';
        ajax_jquery({
            url: apiUrl +'/api/order/detail',
            data: {
                'id':order_id
            },
            async:false,
            success: function(resp) { // data 保存提交后返回的数据，一般为 json 数据
                if(resp.code == 1){
                    if(resp.data.info.property == '3'){
                        keyList = keyList_guarantors;
                    }
                    $(".order-sn").text(resp.data.info.sn);
                    $(".order-type").text(g_orderType[resp.data.info.type]);
                    $(".order-loaner").text(resp.data.info.name);
                    $(".order-mobile").text(resp.data.info.mobile);
                    $(".order-idcardNum").text(resp.data.info.idcard_num);
                    $(".order-date").text(formatDate(resp.data.info.create_time));
                    order_type = resp.data.info.type;
                    order_type = order_type > 2 ? (order_type-2) : order_type;
                    $('#type-' + order_type).show();
                }else{
                    if (typeof(resp.msg) == 'string') {
                        ui_alert(resp.msg);
                    }
                }
            }
        });

        $("#uploadpic").GeminiUploader(keyList,picList,{
            formData: {fileType:"image",order_id:order_id,sid:sid},
        });

        var myPicker = myApp.picker({
            input: '#myPicker',
            toolbarCloseText: '完成',
            cols: [
                {
                    textAlign: 'center',
                    values: ['12个月','24个月','36个月']
                }
            ]
        });
        var formatValues = {'12个月':'365','24个月':'730','36个月':'1095'};
        $(function(){
            $("#submit").click(function(){
                var loan_limit = $('#type-'+order_type+' input[name=loan_limit]').val();
                var loan_term = '';
                if(order_type == 1){
                    loan_term = formatValues[$('#myPicker').val()];
                }else if(order_type == 2){
                    loan_term = $('#type-'+order_type+' [name=loan_term]').val();
                }
                if(loan_limit == ""){
                    ui_alert('请输入借款金额');
                    return;
                }else if(loan_term == ""){
                    ui_alert('请输入借款期限');
                    return;
                 }else if(order_type == 2 && (loan_term < 1 || loan_term > 15)){
                    ui_alert('垫资期限为1-15天');
                    return;
                }else if( $('#uploadpic  .fileList img[data-id]').length < keyList.length ){
                    ui_alert("照片资料不全，请补充上传");
                    return;
                }
                ajax_jquery({
                    type: 'post',
                    url: apiUrl +'/api/order/save',
                    datatype:'json',
                    data: {
                        'id': order_id,
						'loan_limit': loan_limit,
                        'loan_term': loan_term
                    },
                    success: function(data) { // data 保存提交后返回的数据，一般为 json 数据
                        if(data.code == 1){
                            ui_alert("订单提交成功", function () {
                                  window.location.href = wechatStaticPath + '/order/index.html?status=3' ;
                             })
                        }else{
                            if (typeof(data.msg) == 'string') {
                                ui_alert(data.msg);
                            }
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>