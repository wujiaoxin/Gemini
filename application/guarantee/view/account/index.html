{extend name="base"/}
{block name="style"}
<link rel="stylesheet" href="/public/business/lib/metronic/css/glyphicons.css">
<link rel="stylesheet" href="/public/business/css/account.css">
<script>
	var info = {};
	try {
		info = JSON.parse('{$infoStr}');
	} catch (e) {
		alert("数据异常");
	}

</script>
{/block}
{block name="body"}
<!--账号设置-->
<div class="account-index">
	<div class="row-fluid">
		<div class="protrait span1"><img src="/public/business/lib/metronic/image/avatar.png"></div>
		<div class="span3">
			<h3 id="dealer_name"></h3>
		</div>
	</div>
	<div class="row-fluid account-item">
		<div class="protrait span1"><a href="#" class="glyphicons user"><i></i></a></div>
		<div class="span3">
			<h4>法人认证</h4>
			<p class="sub-title">实名操作，保证信息真实性</p>
		</div>
		<div class="index-info span5" id="item-idno">
			<a href="#" class="glyphicons circle_ok"><i class="colgreen"></i></a>
			<span id="dealer_idno"></span>
		</div>
	</div>
	<div class="row-fluid account-item">
		<div class="protrait span1"><a href="#" class="glyphicons building"><i></i></a></div>
		<div class="span3">
			<h4>企业认证</h4>
			<p class="sub-title">企业认证</p>
		</div>
		<div class="index-info span5" id="item-creditCode">
			<a href="#" class="glyphicons circle_ok"><i class="colgreen"></i></a>
			<span></span>
		</div>
	</div>
	<div class="row-fluid account-item">
		<div class="protrait span1"><a href="#" class="glyphicons lock"><i></i></a></div>
		<div class="span3">
			<h4>交易密码</h4>
			<p class="sub-title">账户资金变动密码</p>
		</div>
		<div class="index-info span5" id="item-payPwd">
			<a href="#" class="glyphicons"><i class=""></i></a>
			<span></span>
		</div>
		<div class="span2 account-item-btn"><a data-toggle="modal" href="#payPasswordModal" class="btn">设置</a></div>
	</div>
	<div class="row-fluid account-item">
		<div class="protrait span1"><a href="#" class="glyphicons iphone_shake"><i></i></a></div>
		<div class="span3">
			<h4>绑定手机</h4>
			<p class="sub-title">账户动态实时通知</p>
		</div>
		<div class="index-info span5" id="item-mobile">
			<a href="#" class="glyphicons circle_ok"><i class="colgreen"></i></a>
			<span id="dealer_mobile"></span>
		</div>
		<div class="span2 account-item-btn"><a data-toggle="modal" href="#editMobileModal" class="btn">修改</a></div>
	</div>
	<div class="row-fluid account-item">
		<div class="protrait span1"><a href="#" class="glyphicons envelope"><i></i></a></div>
		<div class="span3">
			<h4>绑定邮箱</h4>
			<p class="sub-title">接收最新消息</p>
		</div>
		<div class="index-info span5" id="item-mail">
			<a href="#" class="glyphicons"><i class=""></i></a>
			<span></span>
		</div>
		<div class="span2 account-item-btn"><a data-toggle="modal" href="#editMailModal" class="btn">设置</a></div>
	</div>
</div>

<!-- 交易密码弹窗 -->
<div id="payPasswordModal" class="modal hide fade">
	<div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
	    <h3>交易密码</h3>
	</div>
	<div class="modal-body">
	    <div class="alert hide">
	      	<a class="close"></a>
	      	<span></span>
	    </div>
	    <div class="form-horizontal payPwd">
	      	<div class="control-group">
		        <label class="control-label">注册手机</label>
		        <div class="controls">
		          	<input type="number" class="m-wrap originalMobile" id="payPwd-username" disabled="disabled">
		        </div>
		    </div>
		    <div class="control-group">
	        	<label class="control-label">手机验证码</label>
	        	<div class="controls rel">
					<input class="m-wrap" type="number" placeholder="请输入短信验证码" id="payPwd-smsVerify">
					<a class="getcode" data-form='payPwd' onclick="sendSms(this)" href="javascript:void(0);">发送验证码</a>
	        	</div>
	      	</div>
	      	<div class="control-group">
	        	<label class="control-label">新密码</label>
	        	<div class="controls">
	          		<input type="password" class="m-wrap" id="newPayPwd" maxlength="6">
	        	</div>
	      	</div>
	      	<div class="control-group">
	        	<label class="control-label">确认密码</label>
	        	<div class="controls">
	          		<input type="password" class="m-wrap" id="confirmPayPwd" maxlength="6">
	        	</div>
	      	</div>
	    </div>
	</div>
	<div class="modal-footer">
	    <button type="button" data-dismiss="modal" class="btn">关闭</button>
	    <a class="btn blue" id="payPasswordBtn">确认修改</a>
	</div>
</div>

<!-- 绑定手机号弹窗 -->
<div id="editMobileModal" class="modal hide fade">
	<div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
	    <h3>修改注册手机号</h3>
	</div>
	<div class="modal-body">
	    <div class="alert hide">
	      	<a class="close"></a>
	      	<span></span>
	    </div>
	    <div class="form-horizontal editMobile">
	      	<div class="control-group">
		        <label class="control-label">注册手机</label>
		        <div class="controls">
		          	<input type="number" class="m-wrap originalMobile" id="editMobile-username" disabled="disabled">
		        </div>
		    </div>
		    <div class="control-group">
	        	<label class="control-label">手机验证码</label>
	        	<div class="controls rel">
					<input class="m-wrap" type="number" placeholder="请输入短信验证码" id="editMobile-smsVerify">
					<a class="getcode" data-form='editMobile' onclick="sendSms(this)" href="javascript:void(0);">发送验证码</a>
	        	</div>
	      	</div>
	      	<div class="control-group">
	        	<label class="control-label">新手机</label>
	        	<div class="controls">
	          		<input type="number" class="m-wrap" id="newMobile">
	        	</div>
	      	</div>
	    </div>
	</div>
	<div class="modal-footer">
	    <button type="button" data-dismiss="modal" class="btn">关闭</button>
	    <button type="button" class="btn blue" id="editMobileBtn">确认修改</button>
	</div>
</div>

<!-- 修改邮箱弹窗 -->
<div id="editMailModal" class="modal hide fade">
	<div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
	    <h3>修改邮箱</h3>
	</div>
	<div class="modal-body">
	    <div class="alert hide">
	      	<a class="close"></a>
	      	<span></span>
	    </div>
	    <div class="form-horizontal editMail">
	      	<div class="control-group">
		        <label class="control-label">新邮箱</label>
		        <div class="controls">
		          	<input type="text" id="newMail" class="m-wrap">
		        </div>
		    </div>
	    </div>
	</div>
	<div class="modal-footer">
	    <button type="button" data-dismiss="modal" class="btn">关闭</button>
	    <button type="button" class="btn blue" id="editMailBtn">确认修改</button>
	</div>
</div>
{/block}
{block name="script"}
<script src="/public/business/js/validate.js" type="text/javascript"></script>
<script>
	function hasData(id,spanText){
		$('#'+id).find('.glyphicons').addClass('circle_ok')
						.children('i').addClass('colgreen').end()
						.next('span').text(spanText);
	}

	function hasNoData(id,spanText){
		$('#'+id).find('.glyphicons').addClass('circle_exclamation_mark')
						.children('i').addClass('colyellow').end()
						.next('span').text(spanText);
	}

	jQuery(document).ready(function () {
		var mobile = encryptMobile(info['mobile']);
		$('#dealer_name').text(info['name']);
		$('#dealer_mobile').text(mobile);
		$('.originalMobile').val(info['mobile']);

		if(typeof(info['idno']) == 'string'){
			hasData('item-idno',info['rep']+' '+encryptID(info['idno']));
		}else{
			hasNoData('item-idno','未设置');
		}

		if(typeof(info['credit_code']) == 'string'){
			hasData('item-creditCode',encryptID(info['credit_code']));
		}else{
			hasNoData('item-creditCode','未设置');
		}

		if(typeof(info['paypassword']) == 'string'){
			hasData('item-payPwd','已设置');
		}else{
			hasNoData('item-payPwd','未设置');
		}

		if(typeof(info['email']) == 'string'){
			hasData('item-mail',encryptMail(info['email']));
		}else{
			hasNoData('item-mail','未绑定');
		}

		$('#payPasswordBtn').click(function(){
			var smsVerify = $('#payPwd-smsVerify').val();
			var newPayPwd = $('#newPayPwd').val();
			var confirmPayPwd = $('#confirmPayPwd').val();
			if(smsVerify == ""){
        		ui_alert("请输入短信验证码");
        		return false;
        	}else if(newPayPwd == ""){
				ui_alert("请输入交易密码");
        		return false;
        	}else if(!validatePayPwd(newPayPwd)){
        		ui_alert("请输入6位数字交易密码");
        		return false;
        	}else if(confirmPayPwd == ""){
        		ui_alert("请确认交易密码");
        		return false;
    		}else if(confirmPayPwd != newPayPwd){
    			ui_alert("两次输入密码不一致");
        		return false;
    		}
	        ajax_jquery({
	            url: apiUrl +'/business/account/index',
	            data:{
	            	"smsVerify": smsVerify,
	            	"newPayPwd": newPayPwd
	            },
	            success:function(resp){
	                if (resp.code == "1" ) {
	                		ui_alert("交易密码修改成功","success");
	                        window.location.href = "/business/account/index";
	                } else {
	                    if (typeof(resp.msg) == 'string' && resp.msg != '') {
	                        ui_alert(resp.msg);
	                    } else {
	                        ui_alert("修改失败，请重试!");
	                    }
	                    return false;
	                }
	            }
	        });
		});

		$('#editMobileBtn').click(function(){
			var smsVerify = $('#editMobile-smsVerify').val();
			var newMobile = $('#newMobile').val();
			if(smsVerify == ""){
        		ui_alert("请输入短信验证码");
        		return false;
        	}else if(newMobile == ""){
				ui_alert("请输入新手机号");
        		return false;
        	}else if(!validatePhoneNumber(newMobile)){
        		ui_alert("请输入正确手机号");
        		return false;
        	}
	        ajax_jquery({
	            url: apiUrl +'/business/account/index',
	            data:{
	            	"smsVerify": smsVerify,
	            	"newMobile": newMobile
	            },
	            success:function(resp){
	                if (resp.code == "1" ) {
	                		ui_alert("手机号修改成功","success");
	                        window.location.href = "/business/account/index";
	                } else {
	                    if (typeof(resp.msg) == 'string' && resp.msg != '') {
	                        ui_alert(resp.msg);
	                    } else {
	                        ui_alert("修改失败，请重试!");
	                    }
	                    return false;
	                }
	            }
	        });
		});

		$('#editMailBtn').click(function(){
			var email = $('#newMail').val();
			if(email == ""){
        		ui_alert("请输入邮箱地址");
        		return false;
        	}else if(!checkEmail(email)){
				ui_alert("请输入正确邮箱地址");
        		return false;
        	}
	        ajax_jquery({
	            url: apiUrl +'/business/account/index',
	            data:{
	            	"email": email
	            },
	            success:function(resp){
	                if (resp.code == "1" ) {
	                		ui_alert("邮箱修改成功","success");
	                        window.location.href = "/business/account/index";
	                } else {
	                    if (typeof(resp.msg) == 'string' && resp.msg != '') {
	                        ui_alert(resp.msg);
	                    } else {
	                        ui_alert("修改失败，请重试!");
	                    }
	                    return false;
	                }
	            }
	        });
		});


	});
</script>
{/block}