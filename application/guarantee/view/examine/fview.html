{extend name="base"/}
{block name="style"}
<link rel="stylesheet" type="text/css" href="/application/admin/static/css/metronic.css"/>
<link rel="stylesheet" type="text/css" href="/application/admin/static/lib/lightGallery/css/lightgallery.css"/>
<link rel="stylesheet" type="text/css" href="/public/business/css/selectArea.css">
<link rel="stylesheet" type="text/css" href="/public/business/lib/metronic/css/select2_metro.css">
<style type="text/css">
.pic-container {
 	padding: 0;
}
.pic-container li div {
  	line-height: 160px;
  	height: 160px;
  	margin: 10px 0;
  	overflow: hidden;
  	border: 5px solid #dedede;
  	border-radius: 5px;
}
.pic-container li img {
  	width: 100%;
  	border-radius: 3px;
}
.lg-outer {
    z-index: 9996;
}
.lg-toolbar {
	background: #000;
}
</style>
<script type="text/javascript">
	var info = {};
	try {
		info = JSON.parse('{$infoStr}');
	} catch (e) {
		alert("数据异常");
	}
</script>
{/block}
{block name="body"}
<div class="main-box clearfix">
	<div class="main-box-body clearfix">
		<div class="tabbable tabbable-custom">
			<ul class="nav nav-tabs">
				<li class="active"><a href="#tab_1_1" data-toggle="tab">项目信息</a></li>
				<li><a href="#tab_1_2" data-toggle="tab">客户信息</a></li>
				<!-- <li><a href="#tab_1_3" data-toggle="tab">客户信息</a></li> -->
<!-- 				<li><a href="#tab_1_4" data-toggle="tab">还款信息</a></li>
				<li><a href="#tab_1_5" data-toggle="tab">逾期信息</a></li> -->
				<li><a href="#tab_1_6" data-toggle="tab">附件资料</a></li>
				<li><a href="#tab_1_7" data-toggle="tab">审批历史</a></li>
				<li><a href="#tab_1_8" data-toggle="tab">审核操作</a></li>
			</ul>
			<div class="tab-content">
				<div class="tab-pane active form" id="tab_1_1" name="order_info">
					<div class="form-horizontal form-view">
						<div class="row-fluid">
							<div class="span6">
								<div class="control-group">
									<label class="control-label">项目编号</label>
									<div class="controls">
										<span name="sn" class="customer-info text"></span>
									</div>
								</div>
							</div>
							<div class="span6">
								<div class="control-group">
									<label class="control-label">申请时间</label>
									<div class="controls">
										<span name="create_time" class="customer-info text"></span>
									</div>
								</div>
							</div>
						</div>
						<div class="row-fluid">
							<div class="span6">
								<div class="control-group">
									<label class="control-label">申请金额</label>
									<div class="controls">
										<span name="loan_limit" class="customer-info text"></span>
									</div>
								</div>
							</div>
							<div class="span6">
								<div class="control-group">
									<label class="control-label">审批金额</label>
									<div class="controls">
										<span name="examine_limit" class="customer-info text"></span>
									</div>
								</div>
							</div>
						</div>
						<div class="row-fluid">
							<div class="span6">
								<div class="control-group">
									<label class="control-label">合作银行</label>
									<div class="controls">
										<span name="bank" class="customer-info text"></span>
									</div>
								</div>
							</div>
							<div class="span6">
								<div class="control-group">
									<label class="control-label">银行利率</label>
									<div class="controls">
										<span name="bank_rate" class="customer-info text"></span>
									</div>
								</div>
							</div>
						</div>
						<div class="row-fluid">
							<div class="span6">
								<div class="control-group">
									<label class="control-label">业务员</label>
									<div class="controls">
										<span name="salesman" class="customer-info text"></span>
									</div>
								</div>
							</div>
							<div class="span6">
								<div class="control-group">
									<label class="control-label">联系方式</label>
									<div class="controls">
										<span name="salesmobile" class="customer-info text"></span>
									</div>
								</div>
							</div>
						</div>
						<div class="row-fluid">
							<div class="span6">
								<div class="control-group">
									<label class="control-label">申请进度</label>
									<div class="controls">
										<span name="status" class="customer-info text"></span>
									</div>
								</div>
							</div>
							<div class="span6">
								<div class="control-group">
									<label class="control-label">项目状态</label>
									<div class="controls">
										<span name="" class="customer-info text">正常</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="tab-pane form" id="tab_1_2" name="member_info">
					<div class="form-horizontal form-view">
						<div class="row-fluid">
							<div class="span6">
								<div class="control-group">
									<label class="control-label">手机号</label>
									<div class="controls">
										<span name="mobile" class="customer-info text"></span>
									</div>
								</div>
							</div>
							<div class="span6">
								<div class="control-group">
									<label class="control-label">真实姓名</label>
									<div class="controls">
										<span name="realname" class="customer-info text"></span>
									</div>
								</div>
							</div>
						</div>
						<div class="row-fluid">
							<div class="span6">
								<div class="control-group">
									<label class="control-label">身份证号</label>
									<div class="controls">
										<span name="idcard" class="customer-info text"></span>
									</div>
								</div>
							</div>
							<div class="span6">
								<div class="control-group">
									<label class="control-label">客户评级</label>
									<div class="controls">
										<span name="credit_score" class="customer-info text"></span>
									</div>
								</div>
							</div>
						</div>
						<div class="row-fluid">
							<div class="span6">
								<div class="control-group">
									<label class="control-label">评级备注</label>
									<div class="controls">
										<span name="credit_descr" class="customer-info text"></span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="tab-pane" id="tab_1_6">
					<ul class="pic-container" id="documentInfo">
					</ul>
				</div>
				<div class="tab-pane" id="tab_1_7">
					<table class="table table-hover" id="examine-history">
						<thead>
							<tr>
								<th>序号</th>
								<th>流程节点</th>
								<th>操作人</th>
								<th>操作</th>
								<th>备注</th>
								<th>时间</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
				<div class="tab-pane" id="tab_1_8">
					<div class="form-horizontal">
						<div class="row-fluid">
							<div class="span6 ">
								<div class="control-group">
									<label class="control-label">申请额度</label>
									<div class="controls">
										<input type="number" disabled="disabled" id="loan_limit">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">建议额度</label>
									<div class="controls">
										<input type="number" id="proposal_limit">
									</div>
								</div>
								<div class="control-group" id="examine_limit_block">
									<label class="control-label">审批额度</label>
									<div class="controls">
										<input type="number" id="examine_limit">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label">操作</label>
									<div class="controls">
										<select id="examineStatus">
											<option value="">请选择</option>
											<option value="14">放款审核</option>
											<option value="3">申请垫资</option>
										</select>
									</div>
								</div>
							</div>
							<div class="span6">
								<div class="control-group">
									<label class="control-label">打款账户</label>
									<div class="controls">
										<input type="number">
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="form-group">
						<div class="text-center">
							<a class="btn btn-primary" id="orderExamineBtn">提交</a>
							<button class="btn btn-return" onclick="javascript:history.back(-1);return false;">返 回</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{/block}
{block name="script"}
<script type="text/javascript" src="/public/business/lib/metronic/js/select2.min.js" ></script>
<script type="text/javascript" src="/public/business/lib/metronic/js/chosen.jquery.min.js"></script>
<script type="text/javascript" src="/public/business/js/selectArea.js"></script>
<script type="text/javascript" src="/application/admin/static/js/manager.js"></script>
<script type="text/javascript" src="/application/admin/static/lib/lightGallery/js/lightgallery.js"></script>
<script type="text/javascript" src="/application/admin/static/lib/lightGallery/js/lg-zoom.js"></script>
<script>
	$(".customer-info").each(function(){
		var name = $(this).attr('name');
		var category = $(this).parents('.tab-pane').attr('name');
	    if(typeof(info[category][name]) != 'object'){
	        $(this).text(info[category][name]);
	        if(name == "create_time"){
	        	$(this).text(formatDate(info[category][name]));
	        }else if(name == "type"){
	        	$(this).text(g_orderType[info[category][name]]);
	        }else if(name == "status"){
	        	$(this).text(g_orderStatus[info[category][name]]);
	        }
	    }
	});


	// 审批历史
	function historyTpl(data){
		var html = '';
		var operate = {'view':'查看','loan':'放款审核','recharge':'充值','withdraw':'提现','receivable':'回款','datareview':'资料审核','loanlimit':'额度审核'};
		if(typeof(data) =='object'){
		for(var index = 0; index < data.length; index++){
			var i = index + 1;
		  	html +='<tr>'
		  		+'<td>'+ i+'</td>'
		  		+'<td>'+ g_orderStatus[data[index].status] +'</td>'
		  		+'<td>'+ data[index].operator +'</td>'
		  		+'<td>'+ operate[data[index].action] +'</td>'
		  		+'<td>'+ data[index].descr +'</td>'
		  		+'<td>'+ formatDatetime(data[index].create_time) +'</td>'
		  		 +'</tr>';
			}
		}
		return html;
	}
	$('#examine-history tbody').html(historyTpl(info.examine_log));


	var keyList = [
        {
            form_key:"orderSupplement_pic_1",
            form_label:"身份证正面照"
        },
        {
            form_key:"orderSupplement_pic_2",
            form_label:"身份证反面照"
        },
        {
            form_key:"orderSupplement_pic_3",
            form_label:"人车合照"
        },
        {
            form_key:"orderSupplement_pic_4",
            form_label:"合格证"
        },
        {
            form_key:"orderSupplement_pic_5",
            form_label:"保单证书"
        },
        {
            form_key:"orderSupplement_pic_6",
            form_label:"购车发票"
        },
        {
            form_key:"orderSupplement_pic_7",
            form_label:"首付凭证"
        },
        {
            form_key:"orderSupplement_pic_8",
            form_label:"合同"
        },
        {
            form_key:"orderSupplement_pic_9",
            form_label:"代扣银行卡"
        }];
    var keyList_guarantors = [
        {
            form_key:"orderSupplement_pic_1",
            form_label:"身份证正面照"
        },
        {
            form_key:"orderSupplement_pic_2",
            form_label:"身份证反面照"
        },
        {
            form_key:"orderSupplement_pic_3",
            form_label:"车辆照片1"
        },
        {
            form_key:"orderSupplement_pic_4",
            form_label:"车辆照片2"
        },
        {
            form_key:"orderSupplement_pic_5",
            form_label:"车辆照片3"
        },
        {
            form_key:"orderSupplement_pic_6",
            form_label:"车辆照片4"
        },
        {
            form_key:"orderSupplement_pic_7",
            form_label:"签约照"
        },
        {
            form_key:"orderSupplement_pic_8",
            form_label:"合同"
        }];

	function picTpl(data){
		var html = '';
		if(typeof(data) =='object'){
			$.each(keyList,function(){
				var form_key = this.form_key;
				for(var index = 0; index < data.length; index++){
					if(form_key == data[index].form_key){
						html +=  '<li data-src="' + data[index].path + '" class="span2">'
			                      	+'<div>'
			                        	+ '<a href="#"><img src="' + data[index].path + '"></a>'
			                      	+'</div>'
			                    +'</li>';
					  	break;
					}
				}
				return true;
			});
		}
		return html;
	}
	// if(info.channel_info.property == 3){
	// 	keyList = keyList_guarantors;
	// }
	$('#tab_1_6 .pic-container').html(picTpl(info.files));
	$("#documentInfo").lightGallery();

	function checkLimit(limit){
		if(limit == null || limit === '0.00' ){
			limit = '';
		}
		return limit;
	}

	$('#proposal_limit').attr('disabled','disabled');
	$('#examine_limit').attr('disabled','disabled');
	$('#loan_limit').val(checkLimit(info['order_info']['loan_limit']));
	$('#proposal_limit').val(checkLimit(info['order_info']['proposal_limit']));
	$('#examine_limit').val(checkLimit(info['order_info']['examine_limit']));


</script>
<script>
$(function(){
	var id = getUrlParam('id');

	$('#orderExamineBtn').click(function(){
		var id = info['order_info']['id'];
		var status = $('#examineStatus').val();

		ajax_jquery({
	        url: apiUrl + 'guarantee/examine/fview',
	        data:{
	        	'id': id,
	        	'status': status
	        },
	        success:function(resp){
	            if (resp.code == "1" ) {
	            	ui_alert("审核通过","success");
	            	window.location.href = apiUrl + "/guarantee/examine/finance";
	            } else {
	                if (typeof(resp.msg) == 'string') {
	                    ui_alert(resp.msg);
	                    return false;
	                }
	            }
	        }
		});
	})
})
</script>
{/block}